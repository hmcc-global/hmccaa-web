name: Validate Frontend
inputs:
  strapi_token:
    type: string
    required: true
  strapi_server:
    type: string
    required: true
  host_server:
    type: string
    required: true
runs:
  using: "composite"
  steps:
    # - name: Free up disk space
    #   shell: bash
    #   run: |
    #     echo "Before cleanup:"
    #     df -h
    #     sudo rm -rf /usr/share/dotnet
    #     sudo rm -rf /opt/ghc
    #     sudo rm -rf /usr/local/lib/android
    #     sudo rm -rf /usr/local/share/boost
    #     sudo rm -rf /usr/local/share/chromium
    #     echo "After cleanup:"
    #     df -h
    - name: Build Gatsby
      shell: bash
      run: |
        cd ${{ github.workspace }}/frontend

        # Add env file
        echo 'STRAPI_TOKEN=${{ inputs.strapi_token }}' > ./.env.production
        echo 'STRAPI_API_URL=${{ inputs.strapi_server }}' >> ./.env.production

        npm install
        NODE_ENV=production HOST_ORIGIN=${{ inputs.host_server }} npm run build

        echo "Finished build with error code $?"
